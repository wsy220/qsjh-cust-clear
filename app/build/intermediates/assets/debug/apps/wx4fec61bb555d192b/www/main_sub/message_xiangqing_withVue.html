<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>资讯详情</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css" />
		<link rel="stylesheet" href="../css/main.css" />
		<style>
			.mui-card {
				margin: 0;
			}
			
			#title_big {
				vertical-align: middle;
			}
			
			#title,
			#zuozhe {
				color: #999999;
				font-size: 12px;
			}
			
			.m-right-rem10 {
				margin-right: 10px;
				color: #1D1D1D;
			}
			
			.zantu {
				background: url(../images/zan.png) no-repeat center;
				height: 50px;
				padding-top: 20px;
				padding-left: 5px;
				font-size: 10px;
			}
			
			.mui-btn-outlined {
				margin-left: 2.5rem;
			}
			
			.mui-btn-outlined img {
				width: 40%;
				margin-right: 10px;
			}
			
			.zanszi {
				vertical-align: super;
			}
			
			.pinglunzi .mui-table-view-cell:after {
				height: 1px;
			}
			
			.mui-content>.mui-card:first-child {
				margin-top: 0px;
			}
			
			.mui-table-view-cell p {
				margin-bottom: 0;
			}
			
			.huifu {
				border-bottom: 1px solid #e4e4e4;
			}
			
			.huifu2 {
				background: #F2F2F2;
				line-height: 22px;
				margin-top: 10px;
				padding-left: 10px;
			}
			
			.yuanwen {
				white-space: normal;
			}
			
			.huangzi {
				color: #d68b38;
			}
			
			.imgtouxiang {
				border-radius: 50%;
			}
			
			.mui-bar {
				z-index: 99999;
			}
			
			
		</style>
	</head>

	<body>
		<!--<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">资讯详情</h1>
		</header>-->
		<div class="mui-content" ref="mybox" style="display: none;">
			<div class="mui-card">
				<ul class="mui-table-view" style="text-align: center;">
					<li class="mui-table-view-cell"><span id="title_big">{{title}}</span></li>
				</ul>
				<ul class="mui-table-view" style="text-align: center;">
					<li class="mui-table-view-cell"><span id="title"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span id="zuozhe">{{author}}</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="" style="font-size: 12px; color:#cdcdcd;" id="eyeicon"><span id="readrecord">{{readrecord}}</span></span>
					</li>
				</ul>
				<div class="mui-card-content">
					<div class="mui-card-content-inner">
						<p v-if="publishType == 'dcapp'">
							{{content}}<br><br>
							<img :src="item" class="mui-media-object mui-pull-left" v-for="(item,index) in cover" style="margin-bottom:10px"><br><br>
						</p>
						<p v-else-if="publishType == 'web'" v-html="content">
						</p>
					</div>
					<div id="pinglun" v-if="publishType == 'dcapp'">
						<div class="mui-content-padded">
							<button type="button" class="mui-btn mui-btn-outlined" id="zanbutton" v-on:click="dianzan(guid)">
							<div  v-if="ifdianzan()"><img src="../images/zans.png" id="zantu"><span class="zanszi" id="zanszi">{{zans}}</span></div>
							<div  v-if="!ifdianzan()"><img src="../images/zan.png" id="zantu"><span class="zanszi" id="zanszi">{{zans}}</span></div>
							</button>
						</div>
						<ul class="mui-table-view pinglunzi">
							<li class="mui-table-view-cell">评论：</li>
						</ul>

					</div>
				</div>
			</div>
		</div>

		<ul class="mui-table-view mui-table-view-striped mui-table-view-condensed " id="tableUL" ref="myboxchild">

		</ul>
	</body>
	<script type="text/javascript" src="../js/mui.min.js"></script>
	<script type="text/javascript" src="../js/constants.js"></script>
	<script type="text/javascript" src="../js/xiangyingshi.js"></script>
	<script type="text/javascript" src="../js/jquery-3.1.1.js"></script>
	<script type="text/javascript" src="../plugs/moment/moment.min.js"></script>
	<script type="text/javascript" src="../js/json_time.js"></script>

	<script type="text/javascript" src="../js/art/template-web.js"></script>
	<script type="text/javascript" src="../js/qs/qs.art.extend.js"></script>
	<script type="text/javascript" src="../js/qs/qs.template.js"></script>
	<script type="text/javascript" src="../js/iscroll/iscroll-probe.js"></script>
	<script type="text/javascript" src="../js/qs/qs.iscroll.js"></script>

	<script type="text/javascript" src="../js/vue/vue.min.js"></script>
	<script>
		var ARTICLE_ID = "";
		mui.init();
		var userID = localStorage.getItem("TOKENID");

		function getDefaultData() {
			return {
				cover: [],
				title: '',
				author: '',
				time: '',
				content: '',
				readrecord: '',
				publishType: '',
				zans: '',
				guid: '',
				puid: [] /*点赞人ID*/ ,
				replay: [],
				flag: false
			}
		}

		var vm = new Vue({
			el: '.mui-content',
			data: getDefaultData(),
			created: function() {

				this.ifdianzan()
			},
			methods: {
				resetData: function() { //重置数据
					Object.assign(this.$data, getDefaultData());
				},
				ifdianzan: function() {

					for(var j = 0; j < this.puid.length; j++) {
						if(userID == this.puid[j]) {
							this.flag = true;
						}
					}
					return this.flag;
				}
			}
		});

		mui.plusReady(function() {
			// 加载完毕后关闭等待框，并展示页面

			var currentView = plus.webview.currentWebview();
			currentView.show('slide-in-right', 200);
			plus.nativeUI.closeWaiting();
			//			if(plus.navigator.isImmersedStatusbar()) { // 兼容immersed状态栏模式
			//
			//				// 获取状态栏高度并根据业务需求处理，这里重新计算了子窗口的偏移位置
			//				topoffset = (Math.round(plus.navigator.getStatusbarHeight()) + 45) + 'px';
			//				document.querySelector("header").style.height = topoffset;
			//				document.querySelector("header").style.paddingTop = "20px";
			//				document.querySelector(".mui-bar-nav~.mui-content").style.paddingTop = topoffset;
			//			}

			var self = plus.webview.currentWebview();
			ARTICLE_ID = self.ARTICLEID;

			var url = serverAddress + "/api/article/apparticlecontent/" + ARTICLE_ID;
			var sussess = function(data) {
				console.log("咨询详情" + JSON.stringify(data));
				var articledata = data.data;

				$(".mui-content").attr("style", "display: block;");

				vm.title = articledata.articletitle;
				vm.time = getDate(articledata.createdOn);
				vm.content = formatHttpStringAT(articledata.articlecontent);
				vm.cover = articledata.imgList;
				$("#eyeicon").attr("class", "mui-icon mui-icon-eye");
				vm.readrecord = "阅读量：" + articledata.readcount;

				vm.publishType = articledata.publishType;
				vm.zans = articledata.zanmap.length;
				vm.guid = articledata._id;
				vm.replay = articledata.answer;

				var vm2 = new Vue({
					el: '#tableUL',
					data: getDefaultData(),
					mounted: function() {
						var mybox2 = this.$refs.myboxchild;
						this.fuzhireplay(mybox2);
					},
					methods: {

						fuzhireplay: function(mybox) {

							$(mybox).processTL(templateRegister.text_replay, {
								subanswer: articledata.answer
							}, 'append', function() {});
						}

					}
				})

				//存储文章图片
				for(var i = 0; i < vm.cover.length; i++) {
					vm.cover[i] = formatHttpString(vm.cover[i]);
				}
				//存储点赞人的ID				
				for(var i = 0; i < articledata.zanmap.length; i++) {
					vm.puid.push(articledata.zanmap[i].pauserId);
				}
				//				//判断此人是否曾经点过赞
				//				for(var j = 0; j < vm.puid.length; j++) {
				//					if(userID == vm.puid[j]) {
				//						$("#zantu").attr('src', "../images/zans.png");
				//						$("#zanbutton").attr('disabled', "true");
				//					}
				//				}
				if(articledata.publishType == "web") {
					vm.author = articledata.articleauthor;
				} else if(articledata.publishType == "dcapp") {
					vm.author = articledata.articleauthor;

				}
			};
			commonHttpUtils(url, "get", {}, sussess, error, false);

		});

		function dianzan(guid) {
			if(userID == null) {
				mui.toast("您还没有登录，请登录后再进行点赞操作");
				return false;
			}
			for(var j = 0; j < vm.puid.length; j++) {
				if(userID == vm.puid[j]) {
					$("#zantu").attr('src', "../images/zans.png");
					$("#zanbutton").attr('disabled', "true");
					return false;
				}
			}

			$("#zantu").attr('src', "../images/zans.png");
			var zanurl = serverAddress + "/api/article/pazanarticles/" + guid;
			var zansuccess = function(data) {
				console.log("点赞" + JSON.stringify(data));
				vm.zans = vm.zans + 1;
				$("#zanbutton").attr('disabled', "true");
			}
			commonHttpUtilsLUNBO(zanurl, "put", {}, zansuccess, error, false);
		}
	</script>

</html>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    